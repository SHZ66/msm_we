{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "35be5476-897b-465f-97b3-d4296940857e",
   "metadata": {},
   "source": [
    "# Trp-cage haMSM Construction and Analysis"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "f563572a-4df5-4385-8900-4e09540870eb",
   "metadata": {},
   "source": [
    "For these examples, we'll be constructing an haMSM from simulations of Trp-cage unfolding."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "3dbbba51-2e44-47ea-a93b-82ac433f82b3",
   "metadata": {},
   "outputs": [],
   "source": [
    "from msm_we import msm_we\n",
    "import numpy as np\n",
    "import ray"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "0607a734-641f-4a60-94d8-ed9f8174dcf5",
   "metadata": {},
   "source": [
    "The simulation data I'm using has already been augmented with pairwise alpha-carbon RMSDs, so we just need to strip out an extra dimension that's present in there.\n",
    "\n",
    "(That extra dimension is just an artifact of how this data was prepared)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "eded3b2a-83d2-4d4b-a3f1-db2f5eeb14bf",
   "metadata": {},
   "source": [
    "```\n",
    "R = rms.RMSD(structure,  # universe to align\n",
    "             structure,  # reference universe or atomgroup\n",
    "             select='name CA',  # group to superimpose and calculate RMSD\n",
    "             groupselections=['name CA'],  # groups for RMSD\n",
    "             ref_frame=0)  # frame index of the reference\n",
    "R.run()\n",
    "```"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "63be5074-3003-4a3b-9573-24c4b60e6f4e",
   "metadata": {},
   "source": [
    "This is just to clean up the logging output for display in the documentation webpage."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "01fbd207-b115-4b91-a2bd-a2dee20f7bee",
   "metadata": {},
   "outputs": [],
   "source": [
    "msm_we.log.handlers[0]._log_render.show_time = False\n",
    "msm_we.log.handlers[0].console.width = 65"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "01210f97-6d34-47bb-9fa3-32ead8cb6f6d",
   "metadata": {},
   "source": [
    "## Model building"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "7dad242d-baf6-4a57-89ec-2db08f4ecc57",
   "metadata": {},
   "source": [
    "First, let's set some parameters for haMSM building."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "7671df08-99a0-4b40-9af5-6c90dcb8bd75",
   "metadata": {},
   "outputs": [],
   "source": [
    "h5file_paths = ['data/west.h5']\n",
    "\n",
    "# Number of MSM microstates to initially put in each stratum/WE bin\n",
    "clusters_per_stratum = 35\n",
    "\n",
    "dimreduce_method = 'vamp'\n",
    "\n",
    "# Boundaries of the basis/target, in progress coordinate space\n",
    "pcoord_bounds = {\n",
    "    'basis': [[0, 0.1]],\n",
    "    'target': [[0.7, 100]]\n",
    "}\n",
    "\n",
    "model_name = 'NaCl Sample'\n",
    "\n",
    "# Reference structure\n",
    "ref_file = 'data/2JOF.pdb'\n",
    "\n",
    "# WESTPA resampling time\n",
    "tau = 1e-9"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "d2d27a22-3bef-4503-9442-3109de075602",
   "metadata": {},
   "outputs": [],
   "source": [
    "def processCoordinates(self, coords):\n",
    "    \n",
    "    return coords.reshape(coords.shape[0], -1)\n",
    "    \n",
    "msm_we.modelWE.processCoordinates = processCoordinates"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "d2d66e2e-bd40-4474-aba5-cb2d6c5aadb7",
   "metadata": {
    "tags": []
   },
   "source": [
    "### With `build_analyze_model`\n",
    "\n",
    "You can construct an haMSM (and validation haMSMs) with one call to `build_analyze_model()`."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "7d3526f2-8a43-4c27-ba76-2d1b8deaaa61",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "b6bd8d6f5ee34d55a5584f85735f9632",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Output()"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">2022-10-03 17:30:44,884 INFO worker.py:1509 -- Started a local \n",
       "Ray instance. View the dashboard at <span style=\"color: #008000; text-decoration-color: #008000; font-weight: bold\">127.0.0.1:8265 </span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "2022-10-03 17:30:44,884 INFO worker.py:1509 -- Started a local \n",
       "Ray instance. View the dashboard at \u001b[1;32m127.0.0.1:8265 \u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "737b23ad90fa4ff1a173ed91f86d8baf",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Getting coordSet:   0%|          | 0/100 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Performing weighted vamp                  <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#2769\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">2769</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Performing weighted vamp                  \u001b]8;id=634340;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=704428;file:///home/jd/msm_we/msm_we/msm_we.py#2769\u001b\\\u001b[2m2769\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Weighted vamp will reduce <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">816</span> to <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">496</span>      <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#2782\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">2782</span></a>\n",
       "         components.                               <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Weighted vamp will reduce \u001b[1;36m816\u001b[0m to \u001b[1;36m496\u001b[0m      \u001b]8;id=862489;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=826572;file:///home/jd/msm_we/msm_we/msm_we.py#2782\u001b\\\u001b[2m2782\u001b[0m\u001b]8;;\u001b\\\n",
       "         components.                               \u001b[2m              \u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Be aware: Number of cluster centers is an <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#3057\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">3057</span></a>\n",
       "         important parameter, and can drastically  <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "         affect model quality. We recommend        <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "         examining block-validation results with a <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "         range of numbers of clusters, to check    <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "         for overfitting.                          <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Be aware: Number of cluster centers is an \u001b]8;id=954460;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=105919;file:///home/jd/msm_we/msm_we/msm_we.py#3057\u001b\\\u001b[2m3057\u001b[0m\u001b]8;;\u001b\\\n",
       "         important parameter, and can drastically  \u001b[2m              \u001b[0m\n",
       "         affect model quality. We recommend        \u001b[2m              \u001b[0m\n",
       "         examining block-validation results with a \u001b[2m              \u001b[0m\n",
       "         range of numbers of clusters, to check    \u001b[2m              \u001b[0m\n",
       "         for overfitting.                          \u001b[2m              \u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Beginning stratified clustering.          <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#3064\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">3064</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Beginning stratified clustering.          \u001b]8;id=855718;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=604282;file:///home/jd/msm_we/msm_we/msm_we.py#3064\u001b\\\u001b[2m3064\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Obtaining bin definitions from iteration  <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#3482\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">3482</span></a>\n",
       "         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span> in file data/west.h5                    <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Obtaining bin definitions from iteration  \u001b]8;id=32581;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=469540;file:///home/jd/msm_we/msm_we/msm_we.py#3482\u001b\\\u001b[2m3482\u001b[0m\u001b]8;;\u001b\\\n",
       "         \u001b[1;36m2\u001b[0m in file data/west.h5                    \u001b[2m              \u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Loading pickled bin mapper from H5 for    <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#3486\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">3486</span></a>\n",
       "         stratified clustering<span style=\"color: #808000; text-decoration-color: #808000\">...</span>                  <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Loading pickled bin mapper from H5 for    \u001b]8;id=352783;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=593260;file:///home/jd/msm_we/msm_we/msm_we.py#3486\u001b\\\u001b[2m3486\u001b[0m\u001b]8;;\u001b\\\n",
       "         stratified clustering\u001b[33m...\u001b[0m                  \u001b[2m              \u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Doing stratified clustering with <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">420</span> total <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#254\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">254</span></a>\n",
       "         clusters                                   <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">             </span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Doing stratified clustering with \u001b[1;36m420\u001b[0m total \u001b]8;id=273655;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=851412;file:///home/jd/msm_we/msm_we/msm_we.py#254\u001b\\\u001b[2m254\u001b[0m\u001b]8;;\u001b\\\n",
       "         clusters                                   \u001b[2m             \u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "f63b748e8ab54b5690758c7b7561f6eb",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Clustering:   0%|          | 0/99 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Clustering couldn't use last iteration,   <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#3595\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">3595</span></a>\n",
       "         not all bins filled.                      <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Clustering couldn't use last iteration,   \u001b]8;id=6220;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=883528;file:///home/jd/msm_we/msm_we/msm_we.py#3595\u001b\\\u001b[2m3595\u001b[0m\u001b]8;;\u001b\\\n",
       "         not all bins filled.                      \u001b[2m              \u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Using Ray cluster with <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">16.0</span> CPUs!          <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#873\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">873</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Using Ray cluster with \u001b[1;36m16.0\u001b[0m CPUs!          \u001b]8;id=459167;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=815146;file:///home/jd/msm_we/msm_we/msm_we.py#873\u001b\\\u001b[2m873\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "de9957fa3c2049aaa878d07d1dd4675d",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Submitting discretization tasks:   0%|          | 0/99 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "617304486b83477d849323465a062d0d",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Retrieving discretized trajectories:   0%|          | 0/99 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Discretization complete                   <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4177\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4177</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Discretization complete                   \u001b]8;id=767386;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=658058;file:///home/jd/msm_we/msm_we/msm_we.py#4177\u001b\\\u001b[2m4177\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Using Ray cluster with <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">16.0</span> CPUs!          <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#873\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">873</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Using Ray cluster with \u001b[1;36m16.0\u001b[0m CPUs!          \u001b]8;id=815575;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=171065;file:///home/jd/msm_we/msm_we/msm_we.py#873\u001b\\\u001b[2m873\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "c8bfec18438e43faaa573403b9b9660c",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Submitting fluxmatrix tasks:   0%|          | 0/98 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "0bd338a0c2124eab8b8b4ad51e32e7b6",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Retrieving flux matrices:   0%|          | 0/98 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Fluxmatrices all obtained                 <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4926\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4926</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Fluxmatrices all obtained                 \u001b]8;id=80954;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=661383;file:///home/jd/msm_we/msm_we/msm_we.py#4926\u001b\\\u001b[2m4926\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Started with <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">420</span> clusters, and removed    <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4001\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4001</span></a>\n",
       "         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">350</span>                                       <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Started with \u001b[1;36m420\u001b[0m clusters, and removed    \u001b]8;id=424371;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=528563;file:///home/jd/msm_we/msm_we/msm_we.py#4001\u001b\\\u001b[2m4001\u001b[0m\u001b]8;;\u001b\\\n",
       "         \u001b[1;36m350\u001b[0m                                       \u001b[2m              \u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #800000; text-decoration-color: #800000\">WARNING </span> All clusters were cleaned from bins <span style=\"font-weight: bold\">{</span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">11</span><span style=\"font-weight: bold\">}</span>  <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4017\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4017</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[31mWARNING \u001b[0m All clusters were cleaned from bins \u001b[1m{\u001b[0m\u001b[1;36m11\u001b[0m\u001b[1m}\u001b[0m  \u001b]8;id=771239;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=926135;file:///home/jd/msm_we/msm_we/msm_we.py#4017\u001b\\\u001b[2m4017\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Using Ray cluster with <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">16.0</span> CPUs!          <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#873\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">873</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Using Ray cluster with \u001b[1;36m16.0\u001b[0m CPUs!          \u001b]8;id=662756;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=397050;file:///home/jd/msm_we/msm_we/msm_we.py#873\u001b\\\u001b[2m873\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Using cached model for discretization     <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4113\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4113</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Using cached model for discretization     \u001b]8;id=283977;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=219379;file:///home/jd/msm_we/msm_we/msm_we.py#4113\u001b\\\u001b[2m4113\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "2e3db57d251842afa920b6a58249ecce",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Submitting discretization tasks:   0%|          | 0/99 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "e56bbbae0b1e4d3392d12ab6d04c5eb6",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Retrieving discretized trajectories:   0%|          | 0/99 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Discretization complete                   <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4177\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4177</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Discretization complete                   \u001b]8;id=21594;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=360548;file:///home/jd/msm_we/msm_we/msm_we.py#4177\u001b\\\u001b[2m4177\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000000; text-decoration-color: #000000\">/home/jd/msm_we/msm_we/msm_we.py:4248: VisibleDeprecationWarning:</span>\n",
       "<span style=\"color: #000000; text-decoration-color: #000000\">Creating an ndarray from ragged nested sequences (which is a </span>\n",
       "<span style=\"color: #000000; text-decoration-color: #000000\">list-or-tuple of lists-or-tuples-or ndarrays with different </span>\n",
       "<span style=\"color: #000000; text-decoration-color: #000000\">lengths or shapes) is deprecated. If you meant to do this, you </span>\n",
       "<span style=\"color: #000000; text-decoration-color: #000000\">must specify 'dtype=object' when creating the ndarray.</span>\n",
       "<span style=\"color: #000000; text-decoration-color: #000000\">  self.targetRMSD_all = </span>\n",
       "<span style=\"color: #000000; text-decoration-color: #000000\">np.array(cluster_pcoord_all)[pcoord_sort_indices]</span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[39m/home/jd/msm_we/msm_we/msm_we.py:4248: VisibleDeprecationWarning:\u001b[0m\n",
       "\u001b[39mCreating an ndarray from ragged nested sequences (which is a \u001b[0m\n",
       "\u001b[39mlist-or-tuple of lists-or-tuples-or ndarrays with different \u001b[0m\n",
       "\u001b[39mlengths or shapes) is deprecated. If you meant to do this, you \u001b[0m\n",
       "\u001b[39mmust specify 'dtype=object' when creating the ndarray.\u001b[0m\n",
       "\u001b[39m  self.targetRMSD_all = \u001b[0m\n",
       "\u001b[39mnp.array(cluster_pcoord_all)[pcoord_sort_indices]\u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Using Ray cluster with <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">16.0</span> CPUs!          <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#873\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">873</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Using Ray cluster with \u001b[1;36m16.0\u001b[0m CPUs!          \u001b]8;id=657965;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=900468;file:///home/jd/msm_we/msm_we/msm_we.py#873\u001b\\\u001b[2m873\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "1078ae8d1d594ce8899dd96868189660",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Submitting fluxmatrix tasks:   0%|          | 0/98 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "a507663fc3cd4f91af571545f02de327",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Retrieving flux matrices:   0%|          | 0/98 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Fluxmatrices all obtained                 <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4926\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4926</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Fluxmatrices all obtained                 \u001b]8;id=933709;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=73204;file:///home/jd/msm_we/msm_we/msm_we.py#4926\u001b\\\u001b[2m4926\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span>                                           <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#5571\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">5571</span></a>\n",
       "         Flux converged to <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1.2810e+06</span> after <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span>      <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "         iterations of inverse iteration.          <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m                                           \u001b]8;id=147455;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=47621;file:///home/jd/msm_we/msm_we/msm_we.py#5571\u001b\\\u001b[2m5571\u001b[0m\u001b]8;;\u001b\\\n",
       "         Flux converged to \u001b[1;36m1.2810e+06\u001b[0m after \u001b[1;36m1\u001b[0m      \u001b[2m              \u001b[0m\n",
       "         iterations of inverse iteration.          \u001b[2m              \u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Done with steady-state estimation.        <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#5582\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">5582</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Done with steady-state estimation.        \u001b]8;id=82173;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=185157;file:///home/jd/msm_we/msm_we/msm_we.py#5582\u001b\\\u001b[2m5582\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Beginning analysis of cross-validation    <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#1322\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">1322</span></a>\n",
       "         group <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span>/<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span>.                                <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Beginning analysis of cross-validation    \u001b]8;id=118319;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=517793;file:///home/jd/msm_we/msm_we/msm_we.py#1322\u001b\\\u001b[2m1322\u001b[0m\u001b]8;;\u001b\\\n",
       "         group \u001b[1;36m1\u001b[0m/\u001b[1;36m2\u001b[0m.                                \u001b[2m              \u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Using Ray cluster with <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">16.0</span> CPUs!          <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#873\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">873</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Using Ray cluster with \u001b[1;36m16.0\u001b[0m CPUs!          \u001b]8;id=462486;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=848488;file:///home/jd/msm_we/msm_we/msm_we.py#873\u001b\\\u001b[2m873\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "b8b91618e8da470b87a6b97c4c7fea30",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Submitting fluxmatrix tasks:   0%|          | 0/50 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "71da4fbd0b704a35b6f61d24335a74cf",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Retrieving flux matrices:   0%|          | 0/50 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Fluxmatrices all obtained                 <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4926\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4926</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Fluxmatrices all obtained                 \u001b]8;id=223145;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=107574;file:///home/jd/msm_we/msm_we/msm_we.py#4926\u001b\\\u001b[2m4926\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Started with <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">420</span> clusters, and removed    <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4001\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4001</span></a>\n",
       "         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">370</span>                                       <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Started with \u001b[1;36m420\u001b[0m clusters, and removed    \u001b]8;id=283938;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=242924;file:///home/jd/msm_we/msm_we/msm_we.py#4001\u001b\\\u001b[2m4001\u001b[0m\u001b]8;;\u001b\\\n",
       "         \u001b[1;36m370\u001b[0m                                       \u001b[2m              \u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #800000; text-decoration-color: #800000\">WARNING </span> All clusters were cleaned from bins <span style=\"font-weight: bold\">{</span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">11</span><span style=\"font-weight: bold\">}</span>  <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4017\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4017</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[31mWARNING \u001b[0m All clusters were cleaned from bins \u001b[1m{\u001b[0m\u001b[1;36m11\u001b[0m\u001b[1m}\u001b[0m  \u001b]8;id=814011;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=523000;file:///home/jd/msm_we/msm_we/msm_we.py#4017\u001b\\\u001b[2m4017\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Using Ray cluster with <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">16.0</span> CPUs!          <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#873\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">873</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Using Ray cluster with \u001b[1;36m16.0\u001b[0m CPUs!          \u001b]8;id=944455;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=117277;file:///home/jd/msm_we/msm_we/msm_we.py#873\u001b\\\u001b[2m873\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Using cached model for discretization     <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4113\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4113</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Using cached model for discretization     \u001b]8;id=90766;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=369562;file:///home/jd/msm_we/msm_we/msm_we.py#4113\u001b\\\u001b[2m4113\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "28af1ef7f1e641fb824174c90c73a3d5",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Submitting discretization tasks:   0%|          | 0/99 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "396b4462113c4999b3995c683802e11b",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Retrieving discretized trajectories:   0%|          | 0/99 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Discretization complete                   <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4177\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4177</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Discretization complete                   \u001b]8;id=478203;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=996532;file:///home/jd/msm_we/msm_we/msm_we.py#4177\u001b\\\u001b[2m4177\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Using Ray cluster with <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">16.0</span> CPUs!          <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#873\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">873</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Using Ray cluster with \u001b[1;36m16.0\u001b[0m CPUs!          \u001b]8;id=821615;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=882239;file:///home/jd/msm_we/msm_we/msm_we.py#873\u001b\\\u001b[2m873\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "6163a97542444cb9b1c5fdfb598d0373",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Submitting fluxmatrix tasks:   0%|          | 0/50 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "d0e9c84f2de94728b532671b4a1db708",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Retrieving flux matrices:   0%|          | 0/50 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Fluxmatrices all obtained                 <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4926\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4926</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Fluxmatrices all obtained                 \u001b]8;id=785883;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=185418;file:///home/jd/msm_we/msm_we/msm_we.py#4926\u001b\\\u001b[2m4926\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span>                                           <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#5571\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">5571</span></a>\n",
       "         Flux converged to <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1.0158e+06</span> after <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span>      <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "         iterations of inverse iteration.          <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m                                           \u001b]8;id=973959;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=222953;file:///home/jd/msm_we/msm_we/msm_we.py#5571\u001b\\\u001b[2m5571\u001b[0m\u001b]8;;\u001b\\\n",
       "         Flux converged to \u001b[1;36m1.0158e+06\u001b[0m after \u001b[1;36m1\u001b[0m      \u001b[2m              \u001b[0m\n",
       "         iterations of inverse iteration.          \u001b[2m              \u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Done with steady-state estimation.        <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#5582\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">5582</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Done with steady-state estimation.        \u001b]8;id=812883;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=441457;file:///home/jd/msm_we/msm_we/msm_we.py#5582\u001b\\\u001b[2m5582\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Beginning analysis of cross-validation    <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#1322\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">1322</span></a>\n",
       "         group <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span>/<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span>.                                <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Beginning analysis of cross-validation    \u001b]8;id=883665;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=320618;file:///home/jd/msm_we/msm_we/msm_we.py#1322\u001b\\\u001b[2m1322\u001b[0m\u001b]8;;\u001b\\\n",
       "         group \u001b[1;36m2\u001b[0m/\u001b[1;36m2\u001b[0m.                                \u001b[2m              \u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Using Ray cluster with <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">16.0</span> CPUs!          <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#873\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">873</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Using Ray cluster with \u001b[1;36m16.0\u001b[0m CPUs!          \u001b]8;id=233016;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=540629;file:///home/jd/msm_we/msm_we/msm_we.py#873\u001b\\\u001b[2m873\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "abb93fa72df6465988d161ed16cf2d73",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Submitting fluxmatrix tasks:   0%|          | 0/49 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Fluxmatrices all obtained                 <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4926\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4926</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Fluxmatrices all obtained                 \u001b]8;id=509348;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=137052;file:///home/jd/msm_we/msm_we/msm_we.py#4926\u001b\\\u001b[2m4926\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Started with <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">420</span> clusters, and removed    <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4001\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4001</span></a>\n",
       "         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">372</span>                                       <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Started with \u001b[1;36m420\u001b[0m clusters, and removed    \u001b]8;id=819897;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=971743;file:///home/jd/msm_we/msm_we/msm_we.py#4001\u001b\\\u001b[2m4001\u001b[0m\u001b]8;;\u001b\\\n",
       "         \u001b[1;36m372\u001b[0m                                       \u001b[2m              \u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #800000; text-decoration-color: #800000\">WARNING </span> All clusters were cleaned from bins <span style=\"font-weight: bold\">{</span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">11</span><span style=\"font-weight: bold\">}</span>  <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4017\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4017</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[31mWARNING \u001b[0m All clusters were cleaned from bins \u001b[1m{\u001b[0m\u001b[1;36m11\u001b[0m\u001b[1m}\u001b[0m  \u001b]8;id=439336;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=237287;file:///home/jd/msm_we/msm_we/msm_we.py#4017\u001b\\\u001b[2m4017\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Using Ray cluster with <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">16.0</span> CPUs!          <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#873\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">873</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Using Ray cluster with \u001b[1;36m16.0\u001b[0m CPUs!          \u001b]8;id=831769;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=823092;file:///home/jd/msm_we/msm_we/msm_we.py#873\u001b\\\u001b[2m873\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Using cached model for discretization     <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4113\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4113</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Using cached model for discretization     \u001b]8;id=598221;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=70039;file:///home/jd/msm_we/msm_we/msm_we.py#4113\u001b\\\u001b[2m4113\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "620d3e6aa40f49c0b5a0c1a61930f261",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Submitting discretization tasks:   0%|          | 0/99 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "cd3bbf9613a94e9886c43ffd4f2807e7",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Retrieving discretized trajectories:   0%|          | 0/99 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Discretization complete                   <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4177\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4177</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Discretization complete                   \u001b]8;id=46648;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=550074;file:///home/jd/msm_we/msm_we/msm_we.py#4177\u001b\\\u001b[2m4177\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Using Ray cluster with <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">16.0</span> CPUs!          <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#873\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">873</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Using Ray cluster with \u001b[1;36m16.0\u001b[0m CPUs!          \u001b]8;id=210424;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=240400;file:///home/jd/msm_we/msm_we/msm_we.py#873\u001b\\\u001b[2m873\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "4f9bd72e3a2e4ebb8ab55bce4f2f1ac9",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Submitting fluxmatrix tasks:   0%|          | 0/49 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "8b68e8a3dbfb427fba625d40f701de3e",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Retrieving flux matrices:   0%|          | 0/49 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Fluxmatrices all obtained                 <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4926\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4926</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Fluxmatrices all obtained                 \u001b]8;id=390345;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=511031;file:///home/jd/msm_we/msm_we/msm_we.py#4926\u001b\\\u001b[2m4926\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span>                                           <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#5571\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">5571</span></a>\n",
       "         Flux converged to <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2.0039e+06</span> after <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span>      <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "         iterations of inverse iteration.          <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m                                           \u001b]8;id=426819;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=389653;file:///home/jd/msm_we/msm_we/msm_we.py#5571\u001b\\\u001b[2m5571\u001b[0m\u001b]8;;\u001b\\\n",
       "         Flux converged to \u001b[1;36m2.0039e+06\u001b[0m after \u001b[1;36m1\u001b[0m      \u001b[2m              \u001b[0m\n",
       "         iterations of inverse iteration.          \u001b[2m              \u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Done with steady-state estimation.        <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#5582\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">5582</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Done with steady-state estimation.        \u001b]8;id=668328;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=703718;file:///home/jd/msm_we/msm_we/msm_we.py#5582\u001b\\\u001b[2m5582\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"></pre>\n"
      ],
      "text/plain": []
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "model = msm_we.modelWE()\n",
    "\n",
    "model.build_analyze_model(\n",
    "    file_paths=h5file_paths,\n",
    "    # ref_struct=basis_ref_dict,\n",
    "    ref_struct=ref_file,\n",
    "    modelName=model_name,\n",
    "    basis_pcoord_bounds=pcoord_bounds['basis'],\n",
    "    target_pcoord_bounds=pcoord_bounds['target'],\n",
    "    dimreduce_method=dimreduce_method,\n",
    "    n_clusters=clusters_per_stratum,\n",
    "    tau=tau\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "e2ae3838-76da-457e-94a6-eed89cfd6f9d",
   "metadata": {
    "tags": []
   },
   "source": [
    "### Step-by-step\n",
    "\n",
    "`build_analyze_model()` is just a convenient wrapper around the following steps.\n",
    "\n",
    "You can run them manually if you want to observe each step of the process.\n",
    "\n",
    "It's helpful to start off by running step-by-step while you're starting analysis for a system, to fine-tune parameters without re-running the entire workflow."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "ba4274a4-8802-4908-9a45-f534ef0ba6a4",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000000; text-decoration-color: #000000\">2022-10-03 17:31:04,428 INFO worker.py:1351 -- Calling ray.init()</span>\n",
       "<span style=\"color: #000000; text-decoration-color: #000000\">again after it has already been called.</span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[39m2022-10-03 17:31:04,428 \u001b[0m\u001b[39mINFO worker.py:1351 -- Calling ray.init()\u001b[0m\n",
       "\u001b[39magain after it has already been called.\u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "    <div style=\"margin-left: 50px;display: flex;flex-direction: row;align-items: center\">\n",
       "        <h3 style=\"color: var(--jp-ui-font-color0)\">Ray</h3>\n",
       "        <svg version=\"1.1\" id=\"ray\" width=\"3em\" viewBox=\"0 0 144.5 144.6\" style=\"margin-left: 3em;margin-right: 3em\">\n",
       "            <g id=\"layer-1\">\n",
       "                <path fill=\"#00a2e9\" class=\"st0\" d=\"M97.3,77.2c-3.8-1.1-6.2,0.9-8.3,5.1c-3.5,6.8-9.9,9.9-17.4,9.6S58,88.1,54.8,81.2c-1.4-3-3-4-6.3-4.1\n",
       "                    c-5.6-0.1-9.9,0.1-13.1,6.4c-3.8,7.6-13.6,10.2-21.8,7.6C5.2,88.4-0.4,80.5,0,71.7c0.1-8.4,5.7-15.8,13.8-18.2\n",
       "                    c8.4-2.6,17.5,0.7,22.3,8c1.3,1.9,1.3,5.2,3.6,5.6c3.9,0.6,8,0.2,12,0.2c1.8,0,1.9-1.6,2.4-2.8c3.5-7.8,9.7-11.8,18-11.9\n",
       "                    c8.2-0.1,14.4,3.9,17.8,11.4c1.3,2.8,2.9,3.6,5.7,3.3c1-0.1,2,0.1,3,0c2.8-0.5,6.4,1.7,8.1-2.7s-2.3-5.5-4.1-7.5\n",
       "                    c-5.1-5.7-10.9-10.8-16.1-16.3C84,38,81.9,37.1,78,38.3C66.7,42,56.2,35.7,53,24.1C50.3,14,57.3,2.8,67.7,0.5\n",
       "                    C78.4-2,89,4.7,91.5,15.3c0.1,0.3,0.1,0.5,0.2,0.8c0.7,3.4,0.7,6.9-0.8,9.8c-1.7,3.2-0.8,5,1.5,7.2c6.7,6.5,13.3,13,19.8,19.7\n",
       "                    c1.8,1.8,3,2.1,5.5,1.2c9.1-3.4,17.9-0.6,23.4,7c4.8,6.9,4.6,16.1-0.4,22.9c-5.4,7.2-14.2,9.9-23.1,6.5c-2.3-0.9-3.5-0.6-5.1,1.1\n",
       "                    c-6.7,6.9-13.6,13.7-20.5,20.4c-1.8,1.8-2.5,3.2-1.4,5.9c3.5,8.7,0.3,18.6-7.7,23.6c-7.9,5-18.2,3.8-24.8-2.9\n",
       "                    c-6.4-6.4-7.4-16.2-2.5-24.3c4.9-7.8,14.5-11,23.1-7.8c3,1.1,4.7,0.5,6.9-1.7C91.7,98.4,98,92.3,104.2,86c1.6-1.6,4.1-2.7,2.6-6.2\n",
       "                    c-1.4-3.3-3.8-2.5-6.2-2.6C99.8,77.2,98.9,77.2,97.3,77.2z M72.1,29.7c5.5,0.1,9.9-4.3,10-9.8c0-0.1,0-0.2,0-0.3\n",
       "                    C81.8,14,77,9.8,71.5,10.2c-5,0.3-9,4.2-9.3,9.2c-0.2,5.5,4,10.1,9.5,10.3C71.8,29.7,72,29.7,72.1,29.7z M72.3,62.3\n",
       "                    c-5.4-0.1-9.9,4.2-10.1,9.7c0,0.2,0,0.3,0,0.5c0.2,5.4,4.5,9.7,9.9,10c5.1,0.1,9.9-4.7,10.1-9.8c0.2-5.5-4-10-9.5-10.3\n",
       "                    C72.6,62.3,72.4,62.3,72.3,62.3z M115,72.5c0.1,5.4,4.5,9.7,9.8,9.9c5.6-0.2,10-4.8,10-10.4c-0.2-5.4-4.6-9.7-10-9.7\n",
       "                    c-5.3-0.1-9.8,4.2-9.9,9.5C115,72.1,115,72.3,115,72.5z M19.5,62.3c-5.4,0.1-9.8,4.4-10,9.8c-0.1,5.1,5.2,10.4,10.2,10.3\n",
       "                    c5.6-0.2,10-4.9,9.8-10.5c-0.1-5.4-4.5-9.7-9.9-9.6C19.6,62.3,19.5,62.3,19.5,62.3z M71.8,134.6c5.9,0.2,10.3-3.9,10.4-9.6\n",
       "                    c0.5-5.5-3.6-10.4-9.1-10.8c-5.5-0.5-10.4,3.6-10.8,9.1c0,0.5,0,0.9,0,1.4c-0.2,5.3,4,9.8,9.3,10\n",
       "                    C71.6,134.6,71.7,134.6,71.8,134.6z\"/>\n",
       "            </g>\n",
       "        </svg>\n",
       "        <table>\n",
       "            <tr>\n",
       "                <td style=\"text-align: left\"><b>Python version:</b></td>\n",
       "                <td style=\"text-align: left\"><b>3.9.13</b></td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "                <td style=\"text-align: left\"><b>Ray version:</b></td>\n",
       "                <td style=\"text-align: left\"><b> 2.0.0</b></td>\n",
       "            </tr>\n",
       "            <tr>\n",
       "    <td style=\"text-align: left\"><b>Dashboard:</b></td>\n",
       "    <td style=\"text-align: left\"><b><a href=\"http://127.0.0.1:8265\" target=\"_blank\">http://127.0.0.1:8265</a></b></td>\n",
       "</tr>\n",
       "\n",
       "        </table>\n",
       "    </div>\n",
       "</div>\n"
      ],
      "text/plain": [
       "RayContext(dashboard_url='127.0.0.1:8265', python_version='3.9.13', ray_version='2.0.0', ray_commit='cba26cc83f6b5b8a2ff166594a65cb74c0ec8740', address_info={'node_ip_address': '192.168.1.222', 'raylet_ip_address': '192.168.1.222', 'redis_address': None, 'object_store_address': '/tmp/ray/session_2022-10-03_17-30-43_050737_1101636/sockets/plasma_store', 'raylet_socket_name': '/tmp/ray/session_2022-10-03_17-30-43_050737_1101636/sockets/raylet', 'webui_url': '127.0.0.1:8265', 'session_dir': '/tmp/ray/session_2022-10-03_17-30-43_050737_1101636', 'metrics_export_port': 64702, 'gcs_address': '192.168.1.222:63341', 'address': '192.168.1.222:63341', 'dashboard_agent_listen_port': 52365, 'node_id': '2ae354f7dd286a10b4d14bb738fcdc824b2e675c54748b519e997f47'})"
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "ray.init(ignore_reinit_error=True)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "80f04290-689f-4d4a-9a41-976bf7685d07",
   "metadata": {},
   "outputs": [],
   "source": [
    "model = msm_we.modelWE()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "715b28cf-d35e-4c37-b7fd-a796030167fd",
   "metadata": {},
   "outputs": [],
   "source": [
    "model.initialize(\n",
    "    fileSpecifier=h5file_paths,\n",
    "    refPDBfile=ref_file,\n",
    "    modelName=model_name,\n",
    "    basis_pcoord_bounds=pcoord_bounds['basis'],\n",
    "    target_pcoord_bounds=pcoord_bounds['target'],\n",
    "    dim_reduce_method=dimreduce_method,\n",
    "    tau=tau\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "acba2bbf-3119-4258-8436-fd220c460680",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "0667e71defaf4d539353d115427db6f7",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Getting coordSet:   0%|          | 0/100 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "model.get_iterations()\n",
    "model.get_coordSet(last_iter = model.maxIter, streaming=True)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "2ec23486-d51d-4554-a3c5-eaf9108914fa",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Performing weighted vamp                  <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#2769\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">2769</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Performing weighted vamp                  \u001b]8;id=712020;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=720830;file:///home/jd/msm_we/msm_we/msm_we.py#2769\u001b\\\u001b[2m2769\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Weighted vamp will reduce <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">816</span> to <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">496</span>      <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#2782\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">2782</span></a>\n",
       "         components.                               <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Weighted vamp will reduce \u001b[1;36m816\u001b[0m to \u001b[1;36m496\u001b[0m      \u001b]8;id=994593;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=859177;file:///home/jd/msm_we/msm_we/msm_we.py#2782\u001b\\\u001b[2m2782\u001b[0m\u001b]8;;\u001b\\\n",
       "         components.                               \u001b[2m              \u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "model.dimReduce()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "542161b0-6187-441b-b458-43adacf448b6",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Be aware: Number of cluster centers is an <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#3057\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">3057</span></a>\n",
       "         important parameter, and can drastically  <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "         affect model quality. We recommend        <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "         examining block-validation results with a <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "         range of numbers of clusters, to check    <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "         for overfitting.                          <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Be aware: Number of cluster centers is an \u001b]8;id=929913;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=855513;file:///home/jd/msm_we/msm_we/msm_we.py#3057\u001b\\\u001b[2m3057\u001b[0m\u001b]8;;\u001b\\\n",
       "         important parameter, and can drastically  \u001b[2m              \u001b[0m\n",
       "         affect model quality. We recommend        \u001b[2m              \u001b[0m\n",
       "         examining block-validation results with a \u001b[2m              \u001b[0m\n",
       "         range of numbers of clusters, to check    \u001b[2m              \u001b[0m\n",
       "         for overfitting.                          \u001b[2m              \u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Beginning stratified clustering.          <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#3064\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">3064</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Beginning stratified clustering.          \u001b]8;id=920873;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=109884;file:///home/jd/msm_we/msm_we/msm_we.py#3064\u001b\\\u001b[2m3064\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Obtaining bin definitions from iteration  <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#3482\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">3482</span></a>\n",
       "         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span> in file data/west.h5                    <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Obtaining bin definitions from iteration  \u001b]8;id=322883;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=10176;file:///home/jd/msm_we/msm_we/msm_we.py#3482\u001b\\\u001b[2m3482\u001b[0m\u001b]8;;\u001b\\\n",
       "         \u001b[1;36m2\u001b[0m in file data/west.h5                    \u001b[2m              \u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Loading pickled bin mapper from H5 for    <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#3486\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">3486</span></a>\n",
       "         stratified clustering<span style=\"color: #808000; text-decoration-color: #808000\">...</span>                  <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Loading pickled bin mapper from H5 for    \u001b]8;id=893816;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=116602;file:///home/jd/msm_we/msm_we/msm_we.py#3486\u001b\\\u001b[2m3486\u001b[0m\u001b]8;;\u001b\\\n",
       "         stratified clustering\u001b[33m...\u001b[0m                  \u001b[2m              \u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #800000; text-decoration-color: #800000; font-weight: bold\">ERROR   </span> Stratified clustering currently MUST run  <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#3522\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">3522</span></a>\n",
       "         in streaming mode <span style=\"font-weight: bold\">(</span>and with ray enabled   <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "         for discretization<span style=\"font-weight: bold\">)</span>. Enabling both and    <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "         continuing<span style=\"color: #808000; text-decoration-color: #808000\">...</span>                             <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[1;31mERROR   \u001b[0m Stratified clustering currently MUST run  \u001b]8;id=113502;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=650222;file:///home/jd/msm_we/msm_we/msm_we.py#3522\u001b\\\u001b[2m3522\u001b[0m\u001b]8;;\u001b\\\n",
       "         in streaming mode \u001b[1m(\u001b[0mand with ray enabled   \u001b[2m              \u001b[0m\n",
       "         for discretization\u001b[1m)\u001b[0m. Enabling both and    \u001b[2m              \u001b[0m\n",
       "         continuing\u001b[33m...\u001b[0m                             \u001b[2m              \u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Doing stratified clustering with <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">420</span> total <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#254\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">254</span></a>\n",
       "         clusters                                   <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">             </span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Doing stratified clustering with \u001b[1;36m420\u001b[0m total \u001b]8;id=248439;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=539771;file:///home/jd/msm_we/msm_we/msm_we.py#254\u001b\\\u001b[2m254\u001b[0m\u001b]8;;\u001b\\\n",
       "         clusters                                   \u001b[2m             \u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "c8466a3a337d4651bd13185105bf3e2a",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Clustering:   0%|          | 0/99 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Clustering couldn't use last iteration,   <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#3595\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">3595</span></a>\n",
       "         not all bins filled.                      <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Clustering couldn't use last iteration,   \u001b]8;id=539257;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=160445;file:///home/jd/msm_we/msm_we/msm_we.py#3595\u001b\\\u001b[2m3595\u001b[0m\u001b]8;;\u001b\\\n",
       "         not all bins filled.                      \u001b[2m              \u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Using Ray cluster with <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">16.0</span> CPUs!          <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#873\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">873</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Using Ray cluster with \u001b[1;36m16.0\u001b[0m CPUs!          \u001b]8;id=426758;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=376163;file:///home/jd/msm_we/msm_we/msm_we.py#873\u001b\\\u001b[2m873\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "d4f0d16842a54768a770d2824b7c2610",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Submitting discretization tasks:   0%|          | 0/99 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "a992cff311a040d5a8ea2b6e8850d9b8",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Retrieving discretized trajectories:   0%|          | 0/99 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Discretization complete                   <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4177\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4177</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Discretization complete                   \u001b]8;id=860343;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=741961;file:///home/jd/msm_we/msm_we/msm_we.py#4177\u001b\\\u001b[2m4177\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "model.cluster_coordinates(\n",
    "    n_clusters=clusters_per_stratum,\n",
    "    use_ray=True,\n",
    "    stratified=True,\n",
    "    store_validation_model=True # Required for block validation\n",
    ")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "id": "1dcb56a5-0a6e-4364-bbef-781b1b56c450",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "e39068b4da354f06a18a92da047ba2eb",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Constructing flux matrix:   0%|          | 0/98 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "model.get_fluxMatrix(n_lag=0)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "id": "4653e02d-86cd-49b4-ac13-485973614ad9",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Started with <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">420</span> clusters, and removed    <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4001\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4001</span></a>\n",
       "         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">350</span>                                       <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Started with \u001b[1;36m420\u001b[0m clusters, and removed    \u001b]8;id=439948;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=832126;file:///home/jd/msm_we/msm_we/msm_we.py#4001\u001b\\\u001b[2m4001\u001b[0m\u001b]8;;\u001b\\\n",
       "         \u001b[1;36m350\u001b[0m                                       \u001b[2m              \u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #800000; text-decoration-color: #800000\">WARNING </span> All clusters were cleaned from bins <span style=\"font-weight: bold\">{</span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">11</span><span style=\"font-weight: bold\">}</span>  <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4017\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4017</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[31mWARNING \u001b[0m All clusters were cleaned from bins \u001b[1m{\u001b[0m\u001b[1;36m11\u001b[0m\u001b[1m}\u001b[0m  \u001b]8;id=942130;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=335258;file:///home/jd/msm_we/msm_we/msm_we.py#4017\u001b\\\u001b[2m4017\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Using Ray cluster with <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">16.0</span> CPUs!          <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#873\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">873</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Using Ray cluster with \u001b[1;36m16.0\u001b[0m CPUs!          \u001b]8;id=366468;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=712475;file:///home/jd/msm_we/msm_we/msm_we.py#873\u001b\\\u001b[2m873\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Using cached model for discretization     <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4113\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4113</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Using cached model for discretization     \u001b]8;id=365307;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=872011;file:///home/jd/msm_we/msm_we/msm_we.py#4113\u001b\\\u001b[2m4113\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "db62d6eb6615422f88f4dd2c7e16e768",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Submitting discretization tasks:   0%|          | 0/99 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "d0e70b752b414511bddfdbd526019b3e",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Retrieving discretized trajectories:   0%|          | 0/99 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Discretization complete                   <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4177\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4177</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Discretization complete                   \u001b]8;id=718435;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=758906;file:///home/jd/msm_we/msm_we/msm_we.py#4177\u001b\\\u001b[2m4177\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/jd/msm_we/msm_we/msm_we.py:4248: VisibleDeprecationWarning: Creating an ndarray from ragged nested sequences (which is a list-or-tuple of lists-or-tuples-or ndarrays with different lengths or shapes) is deprecated. If you meant to do this, you must specify 'dtype=object' when creating the ndarray.\n",
      "  self.targetRMSD_all = np.array(cluster_pcoord_all)[pcoord_sort_indices]\n"
     ]
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "ee0d348f743e44ae8efab14e4702d7c8",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Constructing flux matrix:   0%|          | 0/98 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "model.organize_fluxMatrix()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "id": "075e53b5-7117-4775-9edc-a9b535a1b505",
   "metadata": {},
   "outputs": [],
   "source": [
    "model.get_Tmatrix()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "id": "a509d3d9-5f78-4050-8e16-3f88a1b09693",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span>                                           <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#5571\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">5571</span></a>\n",
       "         Flux converged to <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1.2810e+06</span> after <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span>      <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "         iterations of inverse iteration.          <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m                                           \u001b]8;id=299096;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=28391;file:///home/jd/msm_we/msm_we/msm_we.py#5571\u001b\\\u001b[2m5571\u001b[0m\u001b]8;;\u001b\\\n",
       "         Flux converged to \u001b[1;36m1.2810e+06\u001b[0m after \u001b[1;36m1\u001b[0m      \u001b[2m              \u001b[0m\n",
       "         iterations of inverse iteration.          \u001b[2m              \u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Done with steady-state estimation.        <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#5582\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">5582</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Done with steady-state estimation.        \u001b]8;id=939558;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=655330;file:///home/jd/msm_we/msm_we/msm_we.py#5582\u001b\\\u001b[2m5582\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "model.get_steady_state()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "id": "b6d36d4a-06cd-485f-8a71-3dec4d2cc5c4",
   "metadata": {},
   "outputs": [],
   "source": [
    "model.get_steady_state_target_flux()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "id": "1f3272b4-5474-4d0d-9ac2-4429a07b50e7",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Beginning analysis of cross-validation    <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#1322\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">1322</span></a>\n",
       "         group <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span>/<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span>.                                <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Beginning analysis of cross-validation    \u001b]8;id=167282;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=140219;file:///home/jd/msm_we/msm_we/msm_we.py#1322\u001b\\\u001b[2m1322\u001b[0m\u001b]8;;\u001b\\\n",
       "         group \u001b[1;36m1\u001b[0m/\u001b[1;36m2\u001b[0m.                                \u001b[2m              \u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Using Ray cluster with <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">16.0</span> CPUs!          <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#873\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">873</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Using Ray cluster with \u001b[1;36m16.0\u001b[0m CPUs!          \u001b]8;id=916799;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=79005;file:///home/jd/msm_we/msm_we/msm_we.py#873\u001b\\\u001b[2m873\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "5537a7cf5cdd4095a53b770983685526",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Submitting fluxmatrix tasks:   0%|          | 0/50 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "c567c1278f284fa0a72cfbe8c8b575d7",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Retrieving flux matrices:   0%|          | 0/50 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Fluxmatrices all obtained                 <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4926\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4926</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Fluxmatrices all obtained                 \u001b]8;id=331668;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=15542;file:///home/jd/msm_we/msm_we/msm_we.py#4926\u001b\\\u001b[2m4926\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Started with <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">420</span> clusters, and removed    <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4001\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4001</span></a>\n",
       "         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">370</span>                                       <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Started with \u001b[1;36m420\u001b[0m clusters, and removed    \u001b]8;id=678384;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=996288;file:///home/jd/msm_we/msm_we/msm_we.py#4001\u001b\\\u001b[2m4001\u001b[0m\u001b]8;;\u001b\\\n",
       "         \u001b[1;36m370\u001b[0m                                       \u001b[2m              \u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #800000; text-decoration-color: #800000\">WARNING </span> All clusters were cleaned from bins <span style=\"font-weight: bold\">{</span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">11</span><span style=\"font-weight: bold\">}</span>  <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4017\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4017</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[31mWARNING \u001b[0m All clusters were cleaned from bins \u001b[1m{\u001b[0m\u001b[1;36m11\u001b[0m\u001b[1m}\u001b[0m  \u001b]8;id=763492;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=661909;file:///home/jd/msm_we/msm_we/msm_we.py#4017\u001b\\\u001b[2m4017\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Using Ray cluster with <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">16.0</span> CPUs!          <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#873\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">873</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Using Ray cluster with \u001b[1;36m16.0\u001b[0m CPUs!          \u001b]8;id=497998;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=365921;file:///home/jd/msm_we/msm_we/msm_we.py#873\u001b\\\u001b[2m873\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Using cached model for discretization     <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4113\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4113</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Using cached model for discretization     \u001b]8;id=673763;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=563757;file:///home/jd/msm_we/msm_we/msm_we.py#4113\u001b\\\u001b[2m4113\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "9b9d4fb713314a608ebc4fe6255e4dc7",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Submitting discretization tasks:   0%|          | 0/99 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "22bf9112e5544c67bbf25ed5df5f527c",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Retrieving discretized trajectories:   0%|          | 0/99 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Discretization complete                   <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4177\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4177</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Discretization complete                   \u001b]8;id=822839;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=268090;file:///home/jd/msm_we/msm_we/msm_we.py#4177\u001b\\\u001b[2m4177\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Using Ray cluster with <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">16.0</span> CPUs!          <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#873\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">873</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Using Ray cluster with \u001b[1;36m16.0\u001b[0m CPUs!          \u001b]8;id=833980;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=591867;file:///home/jd/msm_we/msm_we/msm_we.py#873\u001b\\\u001b[2m873\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "166a4bc2f28643ea82e465e6a5238c89",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Submitting fluxmatrix tasks:   0%|          | 0/50 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "89e48752bf88422aa253d84bc932cf14",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Retrieving flux matrices:   0%|          | 0/50 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Fluxmatrices all obtained                 <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4926\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4926</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Fluxmatrices all obtained                 \u001b]8;id=904015;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=159831;file:///home/jd/msm_we/msm_we/msm_we.py#4926\u001b\\\u001b[2m4926\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span>                                           <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#5571\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">5571</span></a>\n",
       "         Flux converged to <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1.0158e+06</span> after <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span>      <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "         iterations of inverse iteration.          <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m                                           \u001b]8;id=555572;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=948905;file:///home/jd/msm_we/msm_we/msm_we.py#5571\u001b\\\u001b[2m5571\u001b[0m\u001b]8;;\u001b\\\n",
       "         Flux converged to \u001b[1;36m1.0158e+06\u001b[0m after \u001b[1;36m1\u001b[0m      \u001b[2m              \u001b[0m\n",
       "         iterations of inverse iteration.          \u001b[2m              \u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Done with steady-state estimation.        <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#5582\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">5582</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Done with steady-state estimation.        \u001b]8;id=455450;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=535367;file:///home/jd/msm_we/msm_we/msm_we.py#5582\u001b\\\u001b[2m5582\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Beginning analysis of cross-validation    <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#1322\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">1322</span></a>\n",
       "         group <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span>/<span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2</span>.                                <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Beginning analysis of cross-validation    \u001b]8;id=910893;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=233211;file:///home/jd/msm_we/msm_we/msm_we.py#1322\u001b\\\u001b[2m1322\u001b[0m\u001b]8;;\u001b\\\n",
       "         group \u001b[1;36m2\u001b[0m/\u001b[1;36m2\u001b[0m.                                \u001b[2m              \u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Using Ray cluster with <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">16.0</span> CPUs!          <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#873\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">873</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Using Ray cluster with \u001b[1;36m16.0\u001b[0m CPUs!          \u001b]8;id=58986;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=342310;file:///home/jd/msm_we/msm_we/msm_we.py#873\u001b\\\u001b[2m873\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "9931166333db41c58003d9f52632901c",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Submitting fluxmatrix tasks:   0%|          | 0/49 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "a7d9ae969d3a417b8538ca66b96c7de6",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Retrieving flux matrices:   0%|          | 0/49 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Fluxmatrices all obtained                 <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4926\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4926</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Fluxmatrices all obtained                 \u001b]8;id=728501;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=988774;file:///home/jd/msm_we/msm_we/msm_we.py#4926\u001b\\\u001b[2m4926\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Started with <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">420</span> clusters, and removed    <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4001\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4001</span></a>\n",
       "         <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">372</span>                                       <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Started with \u001b[1;36m420\u001b[0m clusters, and removed    \u001b]8;id=925182;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=846127;file:///home/jd/msm_we/msm_we/msm_we.py#4001\u001b\\\u001b[2m4001\u001b[0m\u001b]8;;\u001b\\\n",
       "         \u001b[1;36m372\u001b[0m                                       \u001b[2m              \u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #800000; text-decoration-color: #800000\">WARNING </span> All clusters were cleaned from bins <span style=\"font-weight: bold\">{</span><span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">11</span><span style=\"font-weight: bold\">}</span>  <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4017\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4017</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[31mWARNING \u001b[0m All clusters were cleaned from bins \u001b[1m{\u001b[0m\u001b[1;36m11\u001b[0m\u001b[1m}\u001b[0m  \u001b]8;id=826076;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=625673;file:///home/jd/msm_we/msm_we/msm_we.py#4017\u001b\\\u001b[2m4017\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Using Ray cluster with <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">16.0</span> CPUs!          <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#873\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">873</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Using Ray cluster with \u001b[1;36m16.0\u001b[0m CPUs!          \u001b]8;id=491927;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=380047;file:///home/jd/msm_we/msm_we/msm_we.py#873\u001b\\\u001b[2m873\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Using cached model for discretization     <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4113\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4113</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Using cached model for discretization     \u001b]8;id=746030;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=219986;file:///home/jd/msm_we/msm_we/msm_we.py#4113\u001b\\\u001b[2m4113\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "771d4e6aac4748d38f17f9d1301dac86",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Submitting discretization tasks:   0%|          | 0/99 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "ca70e9c5cf6d482ea03f4dbc1347eaf4",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Retrieving discretized trajectories:   0%|          | 0/99 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Discretization complete                   <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4177\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4177</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Discretization complete                   \u001b]8;id=224962;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=439634;file:///home/jd/msm_we/msm_we/msm_we.py#4177\u001b\\\u001b[2m4177\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Using Ray cluster with <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">16.0</span> CPUs!          <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#873\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">873</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Using Ray cluster with \u001b[1;36m16.0\u001b[0m CPUs!          \u001b]8;id=656249;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=748511;file:///home/jd/msm_we/msm_we/msm_we.py#873\u001b\\\u001b[2m873\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "2b8cabca99bc4a0faf1a34df18db0720",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Submitting fluxmatrix tasks:   0%|          | 0/49 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "application/vnd.jupyter.widget-view+json": {
       "model_id": "58a8ff7754e74285ab0093eeaf8e8499",
       "version_major": 2,
       "version_minor": 0
      },
      "text/plain": [
       "Retrieving flux matrices:   0%|          | 0/49 [00:00<?, ?it/s]"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Fluxmatrices all obtained                 <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#4926\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">4926</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Fluxmatrices all obtained                 \u001b]8;id=376616;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=857381;file:///home/jd/msm_we/msm_we/msm_we.py#4926\u001b\\\u001b[2m4926\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span>                                           <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#5571\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">5571</span></a>\n",
       "         Flux converged to <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">2.0039e+06</span> after <span style=\"color: #008080; text-decoration-color: #008080; font-weight: bold\">1</span>      <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "         iterations of inverse iteration.          <span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">              </span>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m                                           \u001b]8;id=88839;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=868699;file:///home/jd/msm_we/msm_we/msm_we.py#5571\u001b\\\u001b[2m5571\u001b[0m\u001b]8;;\u001b\\\n",
       "         Flux converged to \u001b[1;36m2.0039e+06\u001b[0m after \u001b[1;36m1\u001b[0m      \u001b[2m              \u001b[0m\n",
       "         iterations of inverse iteration.          \u001b[2m              \u001b[0m\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    },
    {
     "data": {
      "text/html": [
       "<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"color: #000080; text-decoration-color: #000080\">INFO    </span> Done with steady-state estimation.        <a href=\"file:///home/jd/msm_we/msm_we/msm_we.py\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">msm_we.py</span></a><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">:</span><a href=\"file:///home/jd/msm_we/msm_we/msm_we.py#5582\" target=\"_blank\"><span style=\"color: #7f7f7f; text-decoration-color: #7f7f7f\">5582</span></a>\n",
       "</pre>\n"
      ],
      "text/plain": [
       "\u001b[34mINFO    \u001b[0m Done with steady-state estimation.        \u001b]8;id=773865;file:///home/jd/msm_we/msm_we/msm_we.py\u001b\\\u001b[2mmsm_we.py\u001b[0m\u001b]8;;\u001b\\\u001b[2m:\u001b[0m\u001b]8;id=837127;file:///home/jd/msm_we/msm_we/msm_we.py#5582\u001b\\\u001b[2m5582\u001b[0m\u001b]8;;\u001b\\\n"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "model.do_block_validation(\n",
    "    cross_validation_groups=2, \n",
    "    cross_validation_blocks=4\n",
    ")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "4c0fbc5b-6449-4eab-b588-ce75d3c879dd",
   "metadata": {},
   "source": [
    "## Save model"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "id": "e71caed1-9620-456d-96bb-88d5b9df2251",
   "metadata": {},
   "outputs": [],
   "source": [
    "import pickle\n",
    "with open('data/pickled_model', 'wb') as of:\n",
    "    pickle.dump(model, of)"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.9.13"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
